
<!doctype html>
<html>
<head>
  <meta charset="utf-8">

  <!-- Always force latest IE rendering engine or request Chrome Frame -->
  <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">

  <!-- REPLACE X WITH PRODUCT NAME -->
  <title>HAWQ InputFormat for MapReduce | Pivotal HD Docs | Pivotal HD Docs</title>
  <!-- Local CSS stylesheets -->
  <link href="stylesheets/master.css" media="screen,print" rel="stylesheet" type="text/css" />
  <link href="stylesheets/breadcrumbs.css" media="screen,print" rel="stylesheet" type="text/css" />
  <link href="stylesheets/search.css" media="screen,print" rel="stylesheet" type="text/css" />
  <link href="stylesheets/portal-style.css" media="screen,print" rel="stylesheet" type="text/css" />
  <link href="stylesheets/printable.css" media="print" rel="stylesheet" type="text/css" /> 
  <!-- Confluence HTML stylesheet -->
  <link href="stylesheets/site.css" media="screen,print" rel="stylesheet"  type="text/css" /> 
  <!-- Left-navigation code -->
  <!-- http://www.designchemical.com/lab/jquery-vertical-accordion-menu-plugin/examples/# -->
  <link href="stylesheets/dcaccordion.css" rel="stylesheet" type="text/css" />
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js" type="text/javascript"></script>
  <script src='javascripts/jquery.cookie.js' type="text/javascript"></script>
  <script src='javascripts/jquery.hoverIntent.minified.js' type="text/javascript"></script>
  <script src='javascripts/jquery.dcjqaccordion.2.7.min.js' type="text/javascript"></script>
  <script type="text/javascript">
                    $(document).ready(function($){
					$('#accordion-1').dcAccordion({
						eventType: 'click',
						autoClose: true,
						saveState: true,
						disableLink: false,
						speed: 'fast',
						classActive: 'test',
						showCount: true
					});
					});
  </script>
  <link href="stylesheets/skins/graphite.css" rel="stylesheet" type="text/css" />
  <link href="stylesheets/skins/grey.css" rel="stylesheet" type="text/css" /> 
  <!-- End left-navigation code -->
  <script src="javascripts/all.js" type="text/javascript"></script>
  <link href='http://www.gopivotal.com/misc/favicon.ico' rel='shortcut icon'>
</head>

<body class="pivotalcf pivotalcf_getstarted pivotalcf_getstarted_index">
  <div class="viewport">
    <div class="mobile-navigation--wrapper mobile-only">
      <div class="navigation-drawer--container">
        <div class="navigation-item-list">
          <div class="navbar-link active">
            <a href="http://gopivotal.com">
              Home
              <i class="icon-chevron-right pull-right"></i>
            </a>
          </div>
          <div class="navbar-link">
            <a href="http://gopivotal.com/paas">
              PaaS
              <i class="icon-chevron-right pull-right"></i>
            </a>
          </div>
          <div class="navbar-link">
            <a href="http://gopivotal.com/big-data">
              Big Data
              <i class="icon-chevron-right pull-right"></i>
            </a>
          </div>
          <div class="navbar-link">
            <a href="http://gopivotal.com/agile">
              Agile
              <i class="icon-chevron-right pull-right"></i>
            </a>
          </div>
          <div class="navbar-link">
            <a href="http://gopivotal.com/support">
              Help &amp; Support
              <i class="icon-chevron-right pull-right"></i>
            </a>
          </div>
          <div class="navbar-link">
            <a href="http://gopivotal.com/products">
              Products
              <i class="icon-chevron-right pull-right"></i>
            </a>
          </div>
          <div class="navbar-link">
            <a href="http://gopivotal.com/solutions">
              Solutions
              <i class="icon-chevron-right pull-right"></i>
            </a>
          </div>
          <div class="navbar-link">
            <a href="http://gopivotal.com/partners">
              Partners
              <i class="icon-chevron-right pull-right"></i>
            </a>
          </div>
        </div>
      </div>
      <div class="mobile-nav">
        <div class="nav-icon js-open-nav-drawer">
          <i class="icon-reorder"></i>
        </div>
        <div class="header-center-icon">
          <a href="http://gopivotal.com">
            <div class="icon icon-pivotal-logo-mobile"></div>
          </a>
        </div>
      </div>
    </div>

    <div class='wrap'>
      <script src="//use.typekit.net/clb0qji.js" type="text/javascript"></script>
      <script type="text/javascript">
          try {
              Typekit.load();
          } catch (e) {
          }
      </script>
      <script type="text/javascript">
          document.domain = "gopivotal.com";
      </script>
      <div id="search-dropdown-box">
        <div class="search-dropdown--container js-search-dropdown">
          <div class="container-fluid">
            <div class="close-menu-large"><img src="http://www.gopivotal.com/sites/all/themes/gopo13/images/icon-close.png" /></div>
            <div class="search-form--container">
              <div class="form-search">
                <div class='gcse-search'></div>
                <script src="http://www.google.com/jsapi" type="text/javascript"></script>
                <script src="javascripts/cse.js" type="text/javascript"></script>
              </div>
            </div>
          </div>
        </div>
      </div>

      <header class="navbar desktop-only" id="nav">
        <div class="navbar-inner">
            <div class="container-fluid">
                <div class="pivotal-logo--container">
                    <a class="pivotal-logo" href="http://gopivotal.com"><span></span></a>
                </div>

                <ul class="nav pull-right">
                    <li class="navbar-link">
                        <a href="http://www.gopivotal.com/paas" id="paas-nav-link">PaaS</a>
                    </li>
                    <li class="navbar-link">
                        <a href="http://www.gopivotal.com/big-data" id="big-data-nav-link">BIG DATA</a>
                    </li>
                    <li class="navbar-link">
                        <a href="http://www.gopivotal.com/agile" id="agile-nav-link">AGILE</a>
                    </li>
                    <li class="navbar-link">
                        <a href="http://www.gopivotal.com/oss" id="oss-nav-link">OSS</a>
                    </li>
                    <li class="nav-search">
                        <a class="js-search-input-open" id="click-to-search"><span></span></a>
                    </li>
                </ul>
            </div>
            <a href="http://www.gopivotal.com/contact">
                <img id="get-started" src="http://www.gopivotal.com/sites/all/themes/gopo13/images/get-started.png">
            </a>
        </div>
      </header>
      <div class="main-wrap">
        <div class="container-fluid">

          <!-- Google CSE Search Box -->
          <div id='docs-search'>
              <gcse:search></gcse:search>
          </div>
          
          <div id='all-docs-link'>
            <a href="http://docs.gopivotal.com/">All Documentation</a>
          </div>
          
          <div class="container">
            <div id="sub-nav" class="nav-container">              
              
              <!-- Collapsible left-navigation-->
			  <ul class="accordion"  id="accordion-1">
				  <!-- REPLACE <li/> NODES-->

                        <li>
                <a href="index.html">Pivotal HD</a>

                            <ul>
                    <li>
                <a href="PHDEnterprise1.1.1ReleaseNotes.html">PHD Enterprise 1.1.1 Release Notes</a>

                    </li>
            </ul>
                    <ul>
                    <li>
                <a href="PHDServiceBrokerforPivotalCFv1.0.0.0.html">PHD Service Broker for Pivotal CF v1.0.0.0</a>

                    </li>
            </ul>
                    <ul>
                    <li>
                <a href="PHDInstallationandAdministration.html">PHD Installation and Administration</a>

                            <ul>
                    <li>
                <a href="OverviewofPHD.html">Overview of PHD</a>

                    </li>
            </ul>
                    <ul>
                    <li>
                <a href="InstallingPHDUsingtheCLI.html">Installing PHD Using the CLI</a>

                    </li>
            </ul>
                    <ul>
                    <li>
                <a href="UpgradingPHDUsingtheCLI.html">Upgrading PHD Using the CLI</a>

                    </li>
            </ul>
                    <ul>
                    <li>
                <a href="AdministeringPHDUsingtheCLI.html">Administering PHD Using the CLI</a>

                    </li>
            </ul>
                    <ul>
                    <li>
                <a href="PHDFAQFrequentlyAskedQuestions.html">PHD FAQ (Frequently Asked Questions)</a>

                    </li>
            </ul>
                    <ul>
                    <li>
                <a href="PHDTroubleshooting.html">PHD Troubleshooting</a>

                    </li>
            </ul>
            </li>
            </ul>
                    <ul>
                    <li>
                <a href="StackandToolsReference.html">Stack and Tools Reference</a>

                            <ul>
                    <li>
                <a href="OverviewofApacheStackandPivotalComponents.html">Overview of Apache Stack and Pivotal Components</a>

                    </li>
            </ul>
                    <ul>
                    <li>
                <a href="PHD1.1.1Stack-RPMPackage.html">PHD 1.1.1 Stack - RPM Package</a>

                    </li>
            </ul>
                    <ul>
                    <li>
                <a href="PHD1.1.1Stack-BinaryPackage.html">PHD 1.1.1 Stack - Binary Package</a>

                    </li>
            </ul>
                    <ul>
                    <li>
                <a href="PHDMR11.1Stack-RPMPackage.html">PHD MR1 1.1 Stack - RPM Package</a>

                    </li>
            </ul>
                    <ul>
                    <li>
                <a href="PHDMR11.1Stack-BinaryPackage.html">PHD MR1 1.1 Stack - Binary Package</a>

                    </li>
            </ul>
                    <ul>
                    <li>
                <a href="PHDStack-OtherComponents.html">PHD Stack - Other Components</a>

                    </li>
            </ul>
                    <ul>
                    <li>
                <a href="USSUnifiedStorageSystem.html">USS (Unified Storage System)</a>

                    </li>
            </ul>
                    <ul>
                    <li>
                <a href="HVEHadoopVirtualizationExtensions.html">HVE (Hadoop Virtualization Extensions)</a>

                    </li>
            </ul>
                    <ul>
                    <li>
                <a href="Security.html">Security</a>

                    </li>
            </ul>
                    <ul>
                    <li>
                <a href="ManuallyUpgradingPHDfrom1.1to1.1.1-RPM.html">Manually Upgrading PHD from 1.1 to 1.1.1 - RPM</a>

                    </li>
            </ul>
                    <ul>
                    <li>
                <a href="ManuallyUpgradingPHDfrom1.1to1.1.1-Binary.html">Manually Upgrading PHD from 1.1 to 1.1.1 - Binary</a>

                    </li>
            </ul>
            </li>
            </ul>
                    <ul>
                    <li>
                <a href="DataLoaderInstallationandUsage.html">DataLoader Installation and Usage</a>

                            <ul>
                    <li>
                <a href="OverviewofDataLoader.html">Overview of DataLoader</a>

                    </li>
            </ul>
                    <ul>
                    <li>
                <a href="InstallingandConfiguringDataLoader.html">Installing and Configuring DataLoader</a>

                    </li>
            </ul>
                    <ul>
                    <li>
                <a href="UsingDataLoader.html">Using DataLoader</a>

                    </li>
            </ul>
                    <ul>
                    <li>
                <a href="LoadingFilesandPushStreamsintoHAWQUsingPXF.html">Loading Files and Push Streams into HAWQ Using PXF</a>

                    </li>
            </ul>
                    <ul>
                    <li>
                <a href="DataLoaderCommandLineInterface.html">DataLoader Command Line Interface</a>

                    </li>
            </ul>
                    <ul>
                    <li>
                <a href="DataLoaderCopyStrategyandTransferPolicy.html">DataLoader Copy Strategy and Transfer Policy</a>

                    </li>
            </ul>
                    <ul>
                    <li>
                <a href="JobTransferSpecification.html">Job (Transfer) Specification</a>

                    </li>
            </ul>
                    <ul>
                    <li>
                <a href="DataStores.html">Data Stores</a>

                    </li>
            </ul>
                    <ul>
                    <li>
                <a href="ConfiguringFlumeforDataLoaderPushStreaming.html">Configuring Flume for DataLoader Push Streaming</a>

                    </li>
            </ul>
                    <ul>
                    <li>
                <a href="DataLoaderInstallationfromBinaries.html">DataLoader Installation from Binaries</a>

                    </li>
            </ul>
            </li>
            </ul>
            </li>
                        <li>
                <a href="PIVOTALCOMMANDCENTER.html">PIVOTAL COMMAND CENTER</a>

                            <ul>
                    <li>
                <a href="PCC2.1.1ReleaseNotes.html">PCC 2.1.1 Release Notes</a>

                    </li>
            </ul>
                    <ul>
                    <li>
                <a href="PCCUserGuide.html">PCC User Guide</a>

                            <ul>
                    <li>
                <a href="PCCOverview.html">PCC Overview</a>

                    </li>
            </ul>
                    <ul>
                    <li>
                <a href="InstallingPCC.html">Installing PCC</a>

                    </li>
            </ul>
                    <ul>
                    <li>
                <a href="UsingPCC.html">Using PCC</a>

                    </li>
            </ul>
                    <ul>
                    <li>
                <a href="CreatingaYUMEPELRepository.html">Creating a YUM EPEL Repository</a>

                    </li>
            </ul>
                    <ul>
                    <li>
                <a href="CommandLineReference.html">Command Line Reference</a>

                    </li>
            </ul>
            </li>
            </ul>
            </li>
                        <li>
                <a href="PivotalAdvancedDatabaseServices.html">Pivotal Advanced Database Services</a>

                            <ul>
                    <li>
                <a href="PADS1.1.4ReleaseNotes.html">PADS 1.1.4 Release Notes</a>

                    </li>
            </ul>
                    <ul>
                    <li>
                <a href="HAWQInstallation.html">HAWQ Installation</a>

                    </li>
            </ul>
                    <ul>
                    <li>
                <a href="HAWQAdministration.html">HAWQ Administration</a>

                            <ul>
                    <li>
                <a href="HAWQOverview.html">HAWQ Overview</a>

                    </li>
            </ul>
                    <ul>
                    <li>
                <a href="HAWQQueryProcessing.html">HAWQ Query Processing</a>

                    </li>
            </ul>
                    <ul>
                    <li>
                <a href="QueryingData.html">Querying Data</a>

                    </li>
            </ul>
                    <ul>
                    <li>
                <a href="ConfiguringClientAuthentication.html">Configuring Client Authentication</a>

                    </li>
            </ul>
                    <ul>
                    <li>
                <a href="KerberosAuthentication.html">Kerberos Authentication</a>

                    </li>
            </ul>
                    <ul>
                    <li>
                <a href="HAWQInputFormatforMapReduce.html">HAWQ InputFormat for MapReduce</a>

                    </li>
            </ul>
                    <ul>
                    <li>
                <a href="SQLCommandReference.html">SQL Command Reference</a>

                    </li>
            </ul>
                    <ul>
                    <li>
                <a href="ManagementUtilityReference.html">Management Utility Reference</a>

                    </li>
            </ul>
                    <ul>
                    <li>
                <a href="ClientUtilityReference.html">Client Utility Reference</a>

                    </li>
            </ul>
                    <ul>
                    <li>
                <a href="ServerConfigurationParameters.html">Server Configuration Parameters</a>

                    </li>
            </ul>
                    <ul>
                    <li>
                <a href="HAWQEnvironmentVariables.html">HAWQ Environment Variables</a>

                    </li>
            </ul>
                    <ul>
                    <li>
                <a href="HAWQDataTypes.html">HAWQ Data Types</a>

                    </li>
            </ul>
                    <ul>
                    <li>
                <a href="MADlibReferences.html">MADlib References</a>

                    </li>
            </ul>
                    <ul>
                    <li>
                <a href="hawq_toolkitReference.html">hawq_toolkit Reference</a>

                    </li>
            </ul>
            </li>
            </ul>
                    <ul>
                    <li>
                <a href="PivotalExtensionFrameworkPXF.html">Pivotal Extension Framework (PXF)</a>

                            <ul>
                    <li>
                <a href="PXFInstallationandAdministration.html">PXF Installation and Administration</a>

                    </li>
            </ul>
                    <ul>
                    <li>
                <a href="PXFExternalTableandAPIReference.html">PXF External Table and API Reference</a>

                    </li>
            </ul>
            </li>
            </ul>
            </li>
              </ul>        
              
            </div><!--end of sub-nav-->
            <div class="body-container content">

              <!-- Python script replaces main content -->
			  <div id ="main"><h1>HAWQ InputFormat for MapReduce</h1><div class="wiki-content group" id="main-content">
<p>This chapter describes the document format and schema for defining HAWQ MapReduce jobs.</p><p align="LEFT">MapReduce is a programming model developed by Google for processing and generating large data sets on an array of commodity servers. You can use the HAWQ InputFormat option to enable MapReduce jobs to access HAWQ data stored in HDFS.</p><p align="LEFT">To use HAWQ InputFormat, you only need to provide the URL of the database you want to conect to and the table name you want to access. HAWQ InputFormat only fetches the metadata of the database and table with interest which is much less than the table data itself. After getting the metadata, the HAWQ InputFormat figures out where and how the table data is stored in HDFS. It reads and parses those HDFS files and processes the parsed table tuples directly inside a Map task.</p><h2 id="HAWQInputFormatforMapReduce-SupportedDataTypes">Supported Data Types</h2><p align="LEFT">HAWQ InputFormat supports the following data types:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">SQL/HAWQ</th><th class="confluenceTh">JDBC/JAVA</th><th class="confluenceTh">setXXX</th><th class="confluenceTh">getXXX</th></tr><tr><td class="confluenceTd">DECIMAL/NUMERIC</td><td class="confluenceTd">java.math.BigDecimal</td><td class="confluenceTd"><p>setBigDecimal</p></td><td class="confluenceTd"><p>getBigDecimal</p></td></tr><tr><td class="confluenceTd"><p align="LEFT">FLOAT8/DOUBLE PRECISION</p><span style="font-size: medium;"> </span></td><td class="confluenceTd">double</td><td class="confluenceTd">setDouble</td><td class="confluenceTd">getDouble</td></tr><tr><td class="confluenceTd">INT8/BIGINT</td><td class="confluenceTd">long</td><td class="confluenceTd">setLong</td><td class="confluenceTd">getLong</td></tr><tr><td class="confluenceTd"><p>INTEGER/INT4/INT</p><span style="font-size: medium;"> </span></td><td class="confluenceTd">int</td><td class="confluenceTd">setInt</td><td class="confluenceTd">getInt</td></tr><tr><td class="confluenceTd"><p>FLOAT4/REAL</p><span style="font-size: medium;"> </span></td><td class="confluenceTd">float</td><td class="confluenceTd">setFloat</td><td class="confluenceTd">getFloat</td></tr><tr><td class="confluenceTd"><p>SMALLINT/INT2</p><span style="font-size: medium;"> </span></td><td class="confluenceTd">short</td><td class="confluenceTd">setShort</td><td class="confluenceTd">getShort</td></tr><tr><td class="confluenceTd"><p>BOOL/BOOLEAN</p><span style="font-size: medium;"> </span></td><td class="confluenceTd">boolean</td><td class="confluenceTd">setBoolean</td><td class="confluenceTd">getBoolean</td></tr><tr><td class="confluenceTd"><p>VARCHAR/CHAR/TEXT</p><span style="font-size: medium;"> </span></td><td class="confluenceTd">String</td><td class="confluenceTd">setString</td><td class="confluenceTd">getString</td></tr><tr><td class="confluenceTd"><p>DATE</p><span style="font-size: medium;"> </span></td><td class="confluenceTd">java.sql.Date</td><td class="confluenceTd">setDate</td><td class="confluenceTd">getDate</td></tr><tr><td class="confluenceTd"><p>TIME/TIMETZ</p><span style="font-size: medium;"> </span></td><td class="confluenceTd">java.sql.Time</td><td class="confluenceTd">setTime</td><td class="confluenceTd">getTime</td></tr><tr><td class="confluenceTd"><p>TIMESTAMP/TIMSTAMPTZ</p><span style="font-size: medium;"> </span></td><td class="confluenceTd">java.sql.Timestamp</td><td class="confluenceTd">setTimestamp</td><td class="confluenceTd">getTimestamp</td></tr><tr><td class="confluenceTd"><p>ARRAY</p><span style="font-size: medium;"> </span></td><td class="confluenceTd">java.sq.Array</td><td class="confluenceTd">setArray</td><td class="confluenceTd">getArray</td></tr><tr><td class="confluenceTd"><p>BIT/VARBIT</p><span style="font-size: medium;"> </span></td><td class="confluenceTd"><p align="LEFT">com.pivotal.hawq.mapreduce.datatype.</p></td><td class="confluenceTd">setVarbit</td><td class="confluenceTd">getVarbit</td></tr><tr><td class="confluenceTd" colspan="1">BYTEA<span style="font-size: medium;"> </span></td><td class="confluenceTd" colspan="1">byte[] </td><td class="confluenceTd" colspan="1">setByte </td><td class="confluenceTd" colspan="1">getByte </td></tr><tr><td class="confluenceTd" colspan="1">INTERVAL</td><td class="confluenceTd" colspan="1"><p align="LEFT">com.pivotal.hawq.mapreduce.datatype.<br/>HAWQInterval </p></td><td class="confluenceTd" colspan="1">setInterval</td><td class="confluenceTd" colspan="1">getInterval </td></tr><tr><td class="confluenceTd" colspan="1">POINT</td><td class="confluenceTd" colspan="1">com.pivotal.hawq.mapreduce.datatype.<br/>HAWQPoint</td><td class="confluenceTd" colspan="1">setPoint </td><td class="confluenceTd" colspan="1">getPoint </td></tr><tr><td class="confluenceTd" colspan="1">LSEG</td><td class="confluenceTd" colspan="1">com.pivotal.hawq.mapreduce.datatype.<br/>HAWQLseg</td><td class="confluenceTd" colspan="1">setLseg </td><td class="confluenceTd" colspan="1">getLseg </td></tr><tr><td class="confluenceTd" colspan="1">BOX</td><td class="confluenceTd" colspan="1">com.pivotal.hawq.mapreduce.datatype.<br/>HAWQBox</td><td class="confluenceTd" colspan="1">setBox </td><td class="confluenceTd" colspan="1">getBox </td></tr><tr><td class="confluenceTd" colspan="1">CIRCLE</td><td class="confluenceTd" colspan="1">com.pivotal.hawq.mapreduce.datatype.<br/>HAWQCircle</td><td class="confluenceTd" colspan="1">setVircle </td><td class="confluenceTd" colspan="1">getCircle </td></tr><tr><td class="confluenceTd" colspan="1">PATH</td><td class="confluenceTd" colspan="1">com.pivotal.hawq.mapreduce.datatype.<br/>HAWQPath</td><td class="confluenceTd" colspan="1">setPath </td><td class="confluenceTd" colspan="1">getPath </td></tr><tr><td class="confluenceTd" colspan="1">POLYGON</td><td class="confluenceTd" colspan="1">com.pivotal.hawq.mapreduce.datatype.<br/>HAWQPolygon</td><td class="confluenceTd" colspan="1">setPolygon </td><td class="confluenceTd" colspan="1">getPolygon </td></tr><tr><td class="confluenceTd" colspan="1">MACADDR</td><td class="confluenceTd" colspan="1">com.pivotal.hawq.mapreduce.datatype.<br/>HAWQMacaddr</td><td class="confluenceTd" colspan="1">setMacaddr </td><td class="confluenceTd" colspan="1">getMacaddr </td></tr><tr><td class="confluenceTd" colspan="1">INET</td><td class="confluenceTd" colspan="1">com.pivotal.hawq.mapreduce.datatype.<br/>HAWQInet</td><td class="confluenceTd" colspan="1">setInet </td><td class="confluenceTd" colspan="1">getInet </td></tr><tr><td class="confluenceTd" colspan="1">CIDR</td><td class="confluenceTd" colspan="1">com.pivotal.hawq.mapreduce.datatype.<br/>HAWQCIDR</td><td class="confluenceTd" colspan="1">setCIDR </td><td class="confluenceTd" colspan="1">getCIDR </td></tr></tbody></table></div><p align="LEFT"><strong>Note</strong>:The SQL standard defines a different binary string type, called BLOB or BINARY LARGE OBJECT. The corresponding data type in Postgres is bytea. The SQL standard also defines the CLOB type, that corresponds to the Postgres type, TEXT.</p><h2 id="HAWQInputFormatforMapReduce-HAWQInputFormatExample">HAWQ InputFormat Example</h2><p align="LEFT">The following example shows how you can use the HAWQ InputFormat to access HAWQ table data from MapReduce jobs. </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: java; gutter: false" style="font-size:12px;">package com.mycompany.app;
import com.pivotal.hawq.mapreduce.HAWQException;
import com.pivotal.hawq.mapreduce.HAWQInputFormat;
import com.pivotal.hawq.mapreduce.HAWQRecord;
import org.apache.hadoop.conf.Configuration;
import org.apache.hadoop.conf.Configured;
import org.apache.hadoop.fs.Path;
import org.apache.hadoop.io.Text;
import org.apache.hadoop.mapreduce.Job;
import org.apache.hadoop.mapreduce.Mapper;
import org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;
import org.apache.hadoop.util.Tool;
import org.apache.hadoop.util.ToolRunner;
import org.apache.hadoop.io.IntWritable;

import java.io.IOException;
public class HAWQInputFormatDemoDriver extends Configured
implements Tool {

	// CREATE TABLE employees (
	// id INTEGER NOT NULL PRIMARY KEY,// name VARCHAR(32) NOT NULL);
	public static class DemoMapper extends
		Mapper&lt;Void, HAWQRecord, IntWritable, Text&gt; {
	   int id = 0;
	   String name = null;
	   public void map(Void key, HAWQRecord value, Context context)
		throws IOException, InterruptedException {
	    try {
		id = value.getInt(1);
		name = value.getString(2);
	    } catch (HAWQException hawqE) {
		throw new IOException(hawqE.getMessage());
	    }
	    context.write(new IntWritable(id), new Text(name));
	   }
	}
	private static int printUsage() {
	   System.out.println("HAWQInputFormatDemoDriver
	   &lt;database_url&gt; &lt;table_name&gt; &lt;output_path&gt; [username]
	   [password]");
	   ToolRunner.printGenericCommandUsage(System.out);
	   return 2;
	}
 
	public int run(String[] args) throws Exception {
	   if (args.length &lt; 3) {
	    return printUsage();
	   }
	   Job job = new Job(getConf());
	   job.setJobName("hawq-inputformat-demo");
	   job.setJarByClass(HAWQInputFormatDemoDriver.class);
	   job.setMapperClass(DemoMapper.class);
	   job.setMapOutputValueClass(Text.class);
	   job.setOutputValueClass(Text.class);
	   String db_url = args[0];
	   String table_name = args[1];
	   String output_path = args[2];
	   String user_name = null;
	   if (args.length &gt; 3) {
	     user_name = args[3];
	   }
	   String password = null;
	   if (args.length &gt; 4) {
	     password = args[4];
	   }
	   job.setInputFormatClass(HAWQInputFormat.class);
	   HAWQInputFormat.setInput(job.getConfiguration(), db_url,
	   user_name, password, table_name);
	   FileOutputFormat.setOutputPath(job, new
	   Path(output_path));
	   job.setNumReduceTasks(0);
	   int res = job.waitForCompletion(true) ? 0 : 1;
	   return res;
	}
	
	public static void main(String[] args) throws Exception {
	   int res = ToolRunner.run(new Configuration(),
	     new HAWQInputFormatDemoDriver(), args);
	   System.exit(res);
	}
}</pre>
</div></div><p><strong>To compile and run the example:</strong></p><ol><li>Add the following dependencies into the project for compilation:</li><ol><li>HAWQInputFormat jars:</li></ol><ul><li>hawq-mapreduce-common.jar</li><li>hawq-mapreduce-ao.jar</li><li>hawq-mapreduce-tool.jar</li></ul></ol><p align="LEFT" style="margin-left: 60.0px;">Find these jars in the $GPHOME/lib/postgresql/hawq-mr-io/ directory.</p><p align="LEFT" style="margin-left: 60.0px;">b. Required 3rd party jars:</p><ul><li style="margin-left: 30.0px;">postgresql-jdbc.jar</li><li style="margin-left: 30.0px;">snakeyaml.jar</li></ul><p align="LEFT" style="margin-left: 60.0px;">Find these jars under the $GPHOME/lib/postgresql/hawq-mr-io/lib.</p><p align="LEFT" style="margin-left: 60.0px;">c. Hadoop Mapreduce related jars: Find these jars under the install directory of your Hadoop distribution.</p><p align="LEFT" style="margin-left: 30.0px;">2.   Check that you have installed HAWQ, HDFS and Yarn.</p><p align="LEFT" style="margin-left: 30.0px;">3.   Create sample table:</p><p align="LEFT" style="margin-left: 60.0px;">a. Login to HAWQ:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: java; gutter: false" style="font-size:12px;"> psql -d postgres </pre>
</div></div><p align="LEFT" style="margin-left: 60.0px;">b. Create the sample table:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: java; gutter: false" style="font-size:12px;">CREATE TABLE employees (
id INTEGER NOT NULL PRIMARY KEY,
name TEXT NOT NULL);</pre>
</div></div><p align="LEFT" style="margin-left: 60.0px;">c. Insert one tuple:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: java; gutter: false" style="font-size:12px;"> INSERT INTO employees VALUES (1, 'Paul'); </pre>
</div></div><p style="margin-left: 30.0px;">4.   Use the following shell script snippet showing to run the Mapreduce job</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: java; gutter: false" style="font-size:12px;"># Suppose all five needed jars are under ./lib
export
LIBJARS=lib/hawq-mapreduce-common.jar,lib/hawq-mapreduce-ao.
jar,lib/hawq-mapreduce-tool.jar,lib/postgresql-9.2-1003-jdbc
4.jar,lib/snakeyaml-1.12.jar
export
HADOOP_CLASSPATH=lib/hawq-mapreduce-common.jar:lib/hawq-mapr
educe-ao.jar:lib/hawq-mapreduce-tool.jar:lib/postgresql-9.2-
1003-jdbc4.jar:lib/snakeyaml-1.12.jar
# Suppose the built application jar is my-app.jar
hadoop jar my-app.jar
com.mycompany.app.HAWQInputFormatDemoDriver -libjars
${LIBJARS} localhost:5432/postgres employees /tmp/employees</pre>
</div></div><p style="margin-left: 30.0px;">5.  Use the following command to check the result of the Mapreduce job</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: java; gutter: false" style="font-size:12px;">hadoop fs -cat /tmp/employees/*</pre>
</div></div><p style="margin-left: 60.0px;">The output looks as follows:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: java; gutter: false" style="font-size:12px;">1 Paul</pre>
</div></div><h2 id="HAWQInputFormatforMapReduce-AccessingHAWQData">Accessing HAWQ Data</h2><p>You can access HAWQ data using the following interfaces:</p><ul><li>HAWQInputFormat.setInput API: Use this when HAWQ is running.</li><li>Metadata Export Tool: Use this when HAWQ is not running.</li></ul><h3 id="HAWQInputFormatforMapReduce-HAWQInputFormat.setInput">HAWQInputFormat.setInput</h3><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: java; gutter: false" style="font-size:12px;">/**
	* Initializes the map-part of the job with the appropriate input settings
	* through connecting to Database.
	*
	* @param conf
	* The map-reduce job configuration
	* @param db_url
	* The database URL to connect to
	* @param username
	* The username for setting up a connection to the database
	* @param password
	* The password for setting up a connection to the database
	* @param tableName
	* The name of the table to access to
	* @throws Exception
	*/
public static void setInput(Configuration conf, String db_url,
	String username, String password, String tableName)
throws Exception;</pre>
</div></div><h3 id="HAWQInputFormatforMapReduce-MetadataExportTool">Metadata Export Tool</h3><p>Use the metadata export tool, gpextract, to export the metadata of the target table into a local YAMLfile:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: java; gutter: false" style="font-size:12px;">gpextract [-h hostname] [-p port] [-U username] [-ddatabase] [-o output_file] [-W] &lt;tablename&gt;</pre>
</div></div><p>Using the extracted metadata, access HAWQ data through the following interface:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="theme: Confluence; brush: java; gutter: false" style="font-size:12px;">/**
   * Initializes the map-part of the job with the appropriate input settings through reading metadata file stored in local filesystem.
   *
   * To get metadata file, please use gpextract first
   *
   * @param conf
   * The map-reduce job configuration
   * @param pathStr
   * The metadata file path in local filesystem. e.g.
   * /home/gpadmin/metadata/postgres_test
   * @throws Exception
   */
public static void setInput(Configuration conf, String pathStr)
   throws Exception;</pre>
</div></div><p><span style="font-size: medium;"><span style="font-size: medium;"> </span></span></p><p><span style="font-size: medium;"><span style="font-size: medium;"> </span> </span></p><p> </p>
</div></div>


            </div><!-- end of body-container content-->
          </div><!-- end of container -->
        </div><!--end of container-fluid-->
      </div><!--end of main-wrap-->

      <div class="site-footer desktop-only">
          <div class="container-fluid">
              <div class="site-footer-links">
                  <span class="version"><a href='/'>Pivotal Documentation</a></span>
                  <span>&copy;
                      <script>
                          var d = new Date();
                          document.write(d.getFullYear());
                      </script>
                      <a href='http://gopivotal.com'>Pivotal Software</a> Inc. All Rights Reserved.
                  </span>
              </div>
          </div>
      </div>

      <script type="text/javascript">
          (function() {
              var didInit = false;
              function initMunchkin() {
                  if(didInit === false) {
                      didInit = true;
                      Munchkin.init('625-IUJ-009');
                  }
              }
              var s = document.createElement('script');
              s.type = 'text/javascript';
              s.async = true;
              s.src = document.location.protocol + '//munchkin.marketo.net/munchkin.js';
              s.onreadystatechange = function() {
                  if (this.readyState == 'complete' || this.readyState == 'loaded') {
                      initMunchkin();
                  }
              };
              s.onload = initMunchkin;
              document.getElementsByTagName('head')[0].appendChild(s);
          })();
      </script>
  </div><!--end of viewport-->
  <div id="scrim"></div>
</body>
</html>